<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å…¥å®¢æˆ·æ•°æ® - å®¢æˆ·å­˜å‚¨ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/css/common.css">
    <!-- SheetJSåº“ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­å¤„ç†Excelæ–‡ä»¶ -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        .import-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .upload-section {
            background: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        .upload-area {
            border: 2px dashed #d9d9d9;
            border-radius: 4px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }
        .upload-area:hover {
            border-color: #1890ff;
            background: #e6f7ff;
        }
        .upload-area.dragover {
            border-color: #1890ff;
            background: #e6f7ff;
        }
        .upload-icon {
            font-size: 48px;
            color: #1890ff;
            margin-bottom: 15px;
        }
        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
        }
        .upload-hint {
            font-size: 12px;
            color: #999;
        }
        .file-input {
            display: none;
        }
        .selected-file {
            margin-top: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            display: none;
        }
        .selected-file.show {
            display: block;
        }
        .file-name {
            font-weight: bold;
            color: #333;
        }
        .file-size {
            color: #999;
            font-size: 12px;
        }
        .import-button {
            width: 100%;
            padding: 12px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        .import-button:hover:not(:disabled) {
            background: #40a9ff;
        }
        .import-button:disabled {
            background: #d9d9d9;
            cursor: not-allowed;
        }
        .instructions {
            background: #e6f7ff;
            border-left: 4px solid #1890ff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #1890ff;
        }
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 5px 0;
            line-height: 1.6;
        }
        .result-section {
            background: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            display: none;
        }
        .result-section.show {
            display: block;
        }
        .result-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-item {
            flex: 1;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        .stat-item.success {
            background: #f6ffed;
            border-left: 4px solid #52c41a;
        }
        .stat-item.error {
            background: #fff2e8;
            border-left: 4px solid #ff7875;
        }
        .stat-item.warning {
            background: #fff7e6;
            border-left: 4px solid #faad14;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        .error-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .error-item {
            padding: 8px;
            background: #fff2e8;
            border-left: 3px solid #ff7875;
            margin-bottom: 8px;
            font-size: 13px;
        }
        .template-download {
            text-align: center;
            margin-top: 20px;
        }
        .template-download a {
            color: #1890ff;
            text-decoration: none;
        }
        .template-download a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="top-header">
        <div class="system-name">å®¢æˆ·ä¿¡æ¯</div>
        <div class="user-info">
            <a href="javascript:void(0)">æŸ¥è¯¢å‰ç«¯</a>
            <span id="userName">ç™»å½•äºº:ã€åŠ è½½ä¸­...ã€‘</span>
            <a href="javascript:void(0)" onclick="logout()">é€€å‡º</a>
        </div>
    </div>

    <!-- å·¦ä¾§èœå• -->
    <div class="sidebar">
        <div class="menu-title">ç®¡ç†èœå•</div>
        <a href="/pages/index.html" class="menu-item">é¦–é¡µ</a>
        <a href="/pages/list.html" class="menu-item">å®¢æˆ·åˆ—è¡¨</a>
        <a href="/pages/add.html" class="menu-item">æ·»åŠ å®¢æˆ·</a>
        <a href="/pages/edit.html" class="menu-item">ç¼–è¾‘å®¢æˆ·</a>
        <a href="/pages/delete.html" class="menu-item">åˆ é™¤å®¢æˆ·</a>
        <a href="/pages/import.html" class="menu-item active">å¯¼å…¥æ•°æ®</a>
        <a href="/pages/upload-tasks.html" class="menu-item">ä¸Šä¼ ä»»åŠ¡ç®¡ç†</a>
        <a href="/pages/batch-query.html" class="menu-item">æ‰¹é‡æŸ¥è¯¢</a>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <div class="import-container">
            <h2 style="margin-bottom: 20px;">å¯¼å…¥å®¢æˆ·æ•°æ®</h2>

            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="instructions">
                <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
                <ul>
                    <li><strong>æ”¯æŒæ ¼å¼ï¼š</strong>Excelæ–‡ä»¶ï¼ˆ.xls, .xlsxï¼‰å’ŒCSVæ–‡ä»¶ï¼ˆ.csvï¼‰</li>
                    <li><strong>æ–‡ä»¶è¦æ±‚ï¼š</strong>ç¬¬ä¸€è¡Œå¿…é¡»æ˜¯è¡¨å¤´ï¼ŒåŒ…å«ï¼šå§“åã€ç”µè¯ã€é‚®ç®±ã€åœ°å€</li>
                    <li><strong>å¿…å¡«å­—æ®µï¼š</strong>å§“åï¼ˆå…¶ä»–å­—æ®µå¯é€‰ï¼‰</li>
                    <li><strong>æ‰¹é‡å¯¼å…¥ï¼š</strong>æ”¯æŒå¤§æ–‡ä»¶å¯¼å…¥ï¼Œæ•´ä¸ªæ–‡ä»¶ä½œä¸ºä¸€ä¸ªè¡¨æ ¼ç»Ÿä¸€å¤„ç†</li>
                    <li><strong>æ•°æ®éªŒè¯ï¼š</strong>ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯æ•°æ®æ ¼å¼ï¼Œé‡å¤çš„ç”µè¯å·ç ä¼šè¢«è·³è¿‡</li>
                </ul>
            </div>

            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-section">
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
                    <div class="upload-hint">æ”¯æŒ Excel (.xls, .xlsx) å’Œ CSV (.csv) æ ¼å¼</div>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".xls,.xlsx,.csv" onchange="handleFileSelect(event)">
                
                <div class="selected-file" id="selectedFile">
                    <div class="file-name" id="fileName"></div>
                    <div class="file-size" id="fileSize"></div>
                </div>

                <button onclick="importData()" class="import-button" id="importBtn" disabled>å¼€å§‹å¯¼å…¥</button>

                <div class="template-download">
                    <a href="/api/customers/import/template" download="å®¢æˆ·æ•°æ®å¯¼å…¥æ¨¡æ¿.xlsx">ğŸ“¥ ä¸‹è½½å¯¼å…¥æ¨¡æ¿</a>
                </div>
            </div>

            <!-- ä¸Šä¼ è¿›åº¦ -->
            <div class="result-section" id="uploadProgressSection" style="background: #fff7e6; border-left: 4px solid #faad14; display: none;">
                <h3>ğŸ“¤ æ­£åœ¨ä¸Šä¼ æ–‡ä»¶</h3>
                <div style="margin: 15px 0;">
                    <div style="margin-bottom: 10px;">
                        <strong>æ–‡ä»¶åï¼š</strong><span id="uploadFileName">-</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span id="uploadStatusText" style="color: #666;">æ­£åœ¨ä¸Šä¼ ...</span>
                            <span id="uploadProgressPercent" style="font-weight: bold; color: #faad14;">0%</span>
                        </div>
                        <div style="background: #f0f0f0; height: 24px; border-radius: 12px; overflow: hidden; position: relative;">
                            <div id="uploadProgressBar" style="background: linear-gradient(90deg, #faad14, #ffc53d); height: 100%; width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 5px; font-size: 12px; color: #999;">
                            <span id="uploadedSize">0 / 0</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: #fff; border-radius: 4px; color: #666; font-size: 13px;">
                        ğŸ’¡ <strong>æç¤ºï¼š</strong>æ–‡ä»¶æ­£åœ¨ä¸Šä¼ ä¸­ï¼Œè¯·ä¸è¦å…³é—­é¡µé¢ã€‚ä¸Šä¼ å®Œæˆåä¼šè‡ªåŠ¨å¼€å§‹å¤„ç†ã€‚
                    </div>
                    <div style="margin-top: 10px; text-align: center;">
                        <button id="cancelUploadBtn" onclick="cancelUpload()" style="padding: 8px 20px; background: #ff4d4f; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; display: none;">
                            âŒ å–æ¶ˆä¸Šä¼ 
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ -->
            <div class="result-section" id="processingSection" style="background: #e6f7ff; border-left: 4px solid #1890ff;">
                <h3>ğŸ“¤ æ­£åœ¨å¤„ç†çš„ä»»åŠ¡</h3>
                <div style="margin: 15px 0;">
                    <div style="margin-bottom: 10px;">
                        <strong>æ–‡ä»¶åï¼š</strong><span id="processingFileName">-</span>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>çŠ¶æ€ï¼š</strong><span id="processingStatus">å¤„ç†ä¸­...</span>
                    </div>
                    <div id="processingProgress"></div>
                    <div id="processingStats"></div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-radius: 4px; color: #666; font-size: 13px;">
                    ğŸ’¡ <strong>æç¤ºï¼š</strong>ä»»åŠ¡æ­£åœ¨åå°å¤„ç†ï¼Œæ‚¨å¯ä»¥ç¦»å¼€æ­¤é¡µé¢ï¼Œä»»åŠ¡ä¼šç»§ç»­è¿›è¡Œã€‚è¿”å›æ­¤é¡µé¢æ—¶ä¼šè‡ªåŠ¨æ˜¾ç¤ºæœ€æ–°è¿›åº¦ã€‚
                </div>
            </div>

            <!-- å¯¼å…¥ç»“æœ -->
            <div class="result-section" id="resultSection">
                <h3>å¯¼å…¥ç»“æœ</h3>
                <div class="result-stats">
                    <div class="stat-item success">
                        <div class="stat-number" id="successCount">0</div>
                        <div class="stat-label">æˆåŠŸ</div>
                    </div>
                    <div class="stat-item error">
                        <div class="stat-number" id="errorCount">0</div>
                        <div class="stat-label">å¤±è´¥</div>
                    </div>
                    <div class="stat-item warning">
                        <div class="stat-number" id="skipCount">0</div>
                        <div class="stat-label">è·³è¿‡</div>
                    </div>
                </div>
                <div id="errorList" class="error-list"></div>
            </div>
        </div>
    </div>

    <script src="/js/common.js"></script>
    <script src="/js/import.js"></script>
</body>
</html>

